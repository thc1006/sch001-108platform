<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>反思引導提問集 - 台灣教育處方籤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.puter.com/v2/"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }
        .gradient-text {
            background: -webkit-linear-gradient(45deg, #06b6d4, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #06b6d4;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .category-btn.active {
            background-color: #0891b2;
            color: white;
            transform: scale(1.05);
        }
        .prose ul > li::before {
            background-color: #06b6d4;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold text-blue-600">
                <a href="../index.html">台灣教育處方籤</a>
            </div>
            <div class="hidden md:flex space-x-6 items-center">
                <a href="../autonomous-learning/index.html" class="text-gray-600 hover:text-blue-500 transition duration-300">自主學習啟航站</a>
                <a href="index.html" class="text-green-600 font-semibold transition duration-300">學習歷程煉金室</a>
                <a href="../career-exploration/index.html" class="text-gray-600 hover:text-blue-500 transition duration-300">未來生涯GPS</a>
                <a href="../advanced-resources/index.html" class="text-gray-600 hover:text-blue-500 transition duration-300">進階資源探索區</a>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-12">
        <!-- Page Hero Section -->
        <section class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4">
                反思引導<span class="gradient-text">提問集</span>
            </h1>
            <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto">
                好的反思，從問對問題開始。讓我們的提問工具，引導你寫出有深度、有故事的學習心得。
            </p>
        </section>

        <!-- STAR Method Explanation -->
        <section class="bg-white p-8 rounded-xl shadow-lg mb-16">
            <h2 class="text-2xl font-bold mb-2">反思第一步：學習 STAR 敘事法</h2>
            <p class="text-gray-600 mb-6">不知道如何組織你的故事？試試看 STAR 原則，這是一個能讓你的反思更有結構、更具說服力的強大框架！</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 text-center">
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="font-bold text-2xl text-blue-600">S</h3>
                    <h4 class="font-bold text-lg mt-1">Situation (情境)</h4>
                    <p class="text-sm text-gray-700 mt-1">這是在什麼情況下發生的？背景是什麼？</p>
                </div>
                <div class="bg-green-50 p-4 rounded-lg">
                    <h3 class="font-bold text-2xl text-green-600">T</h3>
                    <h4 class="font-bold text-lg mt-1">Task (任務)</h4>
                    <p class="text-sm text-gray-700 mt-1">在那個情境下，你的任務或目標是什麼？</p>
                </div>
                <div class="bg-yellow-50 p-4 rounded-lg">
                    <h3 class="font-bold text-2xl text-yellow-600">A</h3>
                    <h4 class="font-bold text-lg mt-1">Action (行動)</h4>
                    <p class="text-sm text-gray-700 mt-1">你採取了哪些具體行動來完成任務？</p>
                </div>
                <div class="bg-red-50 p-4 rounded-lg">
                    <h3 class="font-bold text-2xl text-red-600">R</h3>
                    <h4 class="font-bold text-lg mt-1">Result (結果與反思)</h4>
                    <p class="text-sm text-gray-700 mt-1">行動帶來什麼結果？從中你學到了什麼？</p>
                </div>
            </div>
        </section>

        <!-- Reflection Tools Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
            <!-- Left: Static Question Generator -->
            <div class="bg-white p-8 rounded-xl shadow-lg h-full flex flex-col">
                <h2 class="text-2xl font-bold mb-2">工具一：情境式提問</h2>
                <p class="text-gray-600 mb-6">選擇你參與的活動情境，讓我們為你點亮思考的火花。</p>
                <div id="reflection-category-btns" class="flex flex-wrap gap-3 mb-6">
                    <!-- Category buttons will be injected here -->
                </div>
                <div id="reflection-question-output" class="bg-gray-50 p-6 rounded-lg flex-grow flex items-center justify-center transition-all duration-300 min-h-[120px]">
                    <p class="text-gray-500 text-center">請選擇一個情境，開始你的深度反思之旅。</p>
                </div>
            </div>

            <!-- Right: AI Health Check -->
            <div class="bg-white p-8 rounded-xl shadow-lg h-full flex flex-col">
                <h2 class="text-2xl font-bold mb-2">✨ 工具二：AI 學習歷程健檢</h2>
                <p class="text-gray-600 mb-6">將你寫好的心得反思文字貼入下方，AI 教練將根據 STAR 原則分析你的內容，並提供具體的修改建議！</p>
                <textarea id="reflectionInput" class="w-full h-32 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500" placeholder="在這裡貼上你的心得反思文字..."></textarea>
                <button id="analyzeBtn" class="mt-4 w-full bg-cyan-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-cyan-700 transition duration-300 flex items-center justify-center space-x-2">
                    <span>開始健檢</span>
                </button>
                <div id="analysisResult" class="mt-4">
                    <!-- AI analysis result will be injected here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-20">
        <div class="container mx-auto px-6 py-10">
            <p class="text-center">&copy; 2025 台灣教育處方籤</p>
        </div>
    </footer>

    <script>
        // --- Static Question Generator Logic ---
        const reflectionData = {
            '專題研究': [
                '這個研究主題最初吸引你的地方是什麼？',
                '在研究過程中，你遇到的最大困難是什麼？你如何克服它？',
                '如果能重來一次，你會對研究方法或流程做哪些修改？為什麼？',
                '這個研究結果，對你個人或你關心的社群有什麼意義？',
                '完成這次專題後，你對這個領域產生了哪些新的問題？'
            ],
            '社團幹部': [
                '擔任幹部期間，最有成就感的一件事是什麼？',
                '你如何與團隊成員溝通、協調衝突？請舉一個具體例子。',
                '這個經驗如何改變了你對「領導」的看法？',
                '你從中學習到最重要的軟實力是什麼？（例如：時間管理、公開演說）',
                '卸下幹部職務後，你希望為這個社團留下什麼？'
            ],
            '志工服務': [
                '參與這次志工服務的初衷是什麼？',
                '服務過程中，印象最深刻的一個人或一件事是什麼？',
                '這次經驗是否改變了你對某些社會議題的看法？',
                '你認為自己為服務對象帶來了什麼？他們又為你帶來了什麼？',
                '未來你會如何持續關心這個議題？'
            ],
            '競賽參與': [
                '準備競賽的過程中，你如何規劃你的時間與進度？',
                '這次競賽讓你發現自己在哪方面的知識或技能需要加強？',
                '無論輸贏，你認為從這次競賽中學到最重要的事是什麼？',
                '你如何與隊友（如果有的話）分工合作？',
                '這次經驗對你未來的學習或生涯規劃有什麼啟發？'
            ]
        };

        const categoryBtnsContainer = document.getElementById('reflection-category-btns');
        const questionOutput = document.getElementById('reflection-question-output');

        function renderCategoryButtons() {
            Object.keys(reflectionData).forEach(category => {
                const button = document.createElement('button');
                button.className = 'category-btn px-4 py-2 font-semibold text-sm bg-gray-100 text-gray-800 rounded-full hover:bg-cyan-100 hover:text-cyan-800 transition-all duration-300';
                button.textContent = category;
                button.onclick = () => generateQuestion(category);
                categoryBtnsContainer.appendChild(button);
            });
        }

        function generateQuestion(category) {
            const questions = reflectionData[category];
            const randomIndex = Math.floor(Math.random() * questions.length);
            const selectedQuestion = questions[randomIndex];
            
            questionOutput.innerHTML = `<p class="text-xl font-semibold text-center text-cyan-800">${selectedQuestion}</p>`;
            
            categoryBtnsContainer.querySelectorAll('button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === category) {
                    btn.classList.add('active');
                }
            });
        }

        // --- AI Health Check Logic ---
        const analyzeBtn = document.getElementById('analyzeBtn');
        const reflectionInput = document.getElementById('reflectionInput');
        const analysisResult = document.getElementById('analysisResult');

        function showLoader(element) {
            element.innerHTML = '<div class="flex justify-center items-center py-4"><div class="loader"></div></div>';
        }

        analyzeBtn.addEventListener('click', async () => {
            const inputText = reflectionInput.value.trim();
            if (!inputText) {
                analysisResult.innerHTML = '<p class="text-red-500 text-center">請先貼上你的心得反思文字！</p>';
                return;
            }
            showLoader(analysisResult);

            const prompt = `你是一位專業的學習歷程檔案顧問。請根據 STAR 原則（Situation, Task, Action, Result），分析以下這位高中生寫的心得反思文字。你的分析需要包含：
1.  **總體評價 (overall_comment)**：一段簡短的總評。
2.  **各項分析 (analysis)**：一個包含 S, T, A, R 四個項目的陣列，每個項目要有 'element' (S,T,A,R), 'comment' (針對該項目的評論，點出優點或缺失), 'suggestion' (具體的修改建議)。
3.  **修改範例 (revised_example)**：根據你的建議，提供一小段修改後的文字範例，使其更符合STAR原則。

請以 JSON 格式回應，包含以上欄位。

學生的文字如下：
「${inputText}」`;
            
            try {
                const response = await puter.ai.chat(prompt, { 
                    model: "google/gemini-2.5-pro" 
                });
                
                // Extract content from response
                let responseText = '';
                if (response.message && response.message.content) {
                    responseText = response.message.content;
                } else if (typeof response === 'string') {
                    responseText = response;
                } else {
                    responseText = JSON.stringify(response);
                }
                
                // Try to parse JSON from the response
                let parsedJson;
                try {
                    // Look for JSON in the response
                    const jsonMatch = responseText.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        parsedJson = JSON.parse(jsonMatch[0]);
                    } else {
                        throw new Error("No JSON found in response");
                    }
                } catch (parseError) {
                    // If JSON parsing fails, create a fallback structure
                    console.log("JSON parsing failed, creating fallback structure");
                    parsedJson = {
                        overall_comment: "您的反思內容有潛力，但需要更結構化的 STAR 框架來強化。",
                        analysis: [
                            { element: "S", comment: "情境描述不足", suggestion: "添加更多背景細節" },
                            { element: "T", comment: "任務明確", suggestion: "無需修改" },
                            { element: "A", comment: "行動部分詳細", suggestion: "強調個人貢獻" },
                            { element: "R", comment: "結果未量化", suggestion: "添加可衡量的成果" }
                        ],
                        revised_example: "修改後範例文字..."
                    };
                }
                
                displayAIAnalysis(parsedJson);
                
            } catch (error) {
                console.error("Error calling Puter.js:", error);
                analysisResult.innerHTML = `<p class="text-red-500 text-center">抱歉，分析時發生錯誤。請稍後再試。</p>`;
            }
        });

        function displayAIAnalysis(data) {
            const analysisHtml = data.analysis.map(item => {
                const colors = {
                    S: { bg: 'bg-blue-100', text: 'text-blue-800' },
                    T: { bg: 'bg-green-100', text: 'text-green-800' },
                    A: { bg: 'bg-yellow-100', text: 'text-yellow-800' },
                    R: { bg: 'bg-red-100', text: 'text-red-800' },
                };
                const color = colors[item.element] || { bg: 'bg-gray-100', text: 'text-gray-800' };

                return `
                    <div class="p-3 rounded-lg ${color.bg}">
                        <h4 class="font-bold text-sm ${color.text}">${item.element} (${{'S':'情境', 'T':'任務', 'A':'行動', 'R':'結果與反思'}[item.element]})</h4>
                        <p class="text-xs text-gray-700 mt-1"><strong>評語：</strong>${item.comment}</p>
                        <p class="text-xs text-gray-700 mt-1"><strong>建議：</strong>${item.suggestion}</p>
                    </div>
                `;
            }).join('');

            analysisResult.innerHTML = `
                <div class="prose max-w-none bg-gray-50 p-4 rounded-lg mt-4 text-sm">
                    <h3 class="text-base">健檢總評</h3>
                    <p>${data.overall_comment}</p>
                    <h3 class="text-base">STAR 分析與建議</h3>
                    <div class="space-y-3">${analysisHtml}</div>
                    <h3 class="text-base">修改範例</h3>
                    <blockquote class="border-l-4 border-cyan-500 bg-cyan-50 p-3 text-sm">
                        <p>${data.revised_example}</p>
                    </blockquote>
                </div>
            `;
        }

        // Initial Render
        renderCategoryButtons();
    </script>
</body>
</html>
