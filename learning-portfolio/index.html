<!DOCTYPE html>
<html lang="zh-Hant" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>學習歷程煉金室 v2.1 - 台灣教育處方籤 (Puter.js 整合版)</title>
    
    <script src="https://js.puter.com/v2/"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }
        .gradient-text {
            background: -webkit-linear-gradient(45deg, #22c55e, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            max-height: 90vh;
        }
        .tab-btn.active {
            border-bottom-color: #10b981;
            color: #10b981;
        }
        .tag-btn {
            transition: all 0.2s ease-in-out;
        }
        .tag-btn.active {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <header class="bg-white/80 backdrop-blur-lg shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold text-blue-600">
                <a href="#">台灣教育處方籤</a>
            </div>
            <div class="hidden md:flex space-x-6 items-center">
                <a href="#gallery-section" class="text-gray-600 hover:text-green-500 transition duration-300">優質範例</a>
                <a href="#reflection-section" class="text-gray-600 hover:text-cyan-500 transition duration-300">反思引導</a>
                <a href="#activity-section" class="text-gray-600 hover:text-sky-500 transition duration-300">多元表現</a>
                <a href="#ai-assistant-section" class="text-gray-600 hover:text-indigo-500 transition duration-300">AI 小助理</a>
            </div>
            <div class="md:hidden">
                <button id="mobile-menu-btn" class="text-gray-600 focus:outline-none">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
            </div>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden px-6 pb-4">
            <a href="#gallery-section" class="block py-2 text-gray-600 hover:text-green-500">優質範例</a>
            <a href="#reflection-section" class="block py-2 text-gray-600 hover:text-cyan-500">反思引導</a>
            <a href="#activity-section" class="block py-2 text-gray-600 hover:text-sky-500">多元表現</a>
            <a href="#ai-assistant-section" class="block py-2 text-gray-600 hover:text-indigo-500">AI 小助理</a>
        </div>
    </header>

    <main class="container mx-auto px-6 py-12">
        <section class="text-center mb-20">
            <h1 class="text-4xl md:text-6xl font-bold text-gray-800 mb-4 leading-tight">
                學習歷程<span class="gradient-text">煉金室</span>
            </h1>
            <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto">
                告別無效的檔案堆疊。將你的學習經驗與反思，淬鍊成展現個人特質的亮點。
            </p>
        </section>

        <section id="gallery-section" class="mb-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold">優質範例藝廊</h2>
                <p class="text-lg text-gray-600 mt-2">參考多元範例，學習如何呈現你的獨特之處。</p>
            </div>
            <div class="flex justify-center flex-wrap gap-3 mb-8" id="gallery-filters">
                </div>
            <div id="gallery-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                </div>
        </section>

        <section id="reflection-section" class="mb-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold">反思引導提問集</h2>
                <p class="text-lg text-gray-600 mt-2">點擊下方類別，探索能深化你學習心得的問題。</p>
            </div>
            <div class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-lg">
                <div id="reflection-category-btns" class="flex flex-wrap justify-center gap-3 mb-8">
                    </div>
                <div id="reflection-question-output" class="bg-gray-50 p-6 rounded-lg min-h-[120px] flex items-center justify-center transition-all duration-300">
                    <p class="text-gray-500">請選擇一個類別來產生問題。</p>
                </div>
            </div>
        </section>

        <section id="activity-section" class="mb-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold">多元表現資料庫</h2>
                <p class="text-lg text-gray-600 mt-2">想豐富你的多元表現？從這裡尋找靈感與機會！</p>
            </div>
            <div class="max-w-6xl mx-auto bg-white p-8 rounded-xl shadow-lg">
                <div class="flex justify-center flex-wrap gap-3 mb-8" id="activity-filters">
                    </div>
                <div id="activity-list" class="space-y-4">
                    </div>
            </div>
        </section>
        
        <section id="ai-assistant-section" class="mb-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold">AI 學習反思小助理</h2>
                <p class="text-lg text-gray-600 mt-2">將你的初步想法，交給 AI 助理進行潤飾與發想。</p>
            </div>
            <div class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-lg">
                <div class="mb-4">
                    <label for="ai-prompt" class="block text-sm font-medium text-gray-700 mb-2">1. 選擇或輸入一個引導問題 (可從上方提問集複製)：</label>
                    <input type="text" id="ai-prompt" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="例如：這個研究主題最初吸引你的地方是什麼？">
                </div>
                <div class="mb-4">
                    <label for="ai-input" class="block text-sm font-medium text-gray-700 mb-2">2. 在下方寫下你的初步想法或草稿：</label>
                    <textarea id="ai-input" rows="6" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="我參加了關於校園植物含菌量的科展，因為疫情期間大家都很注重消毒，我就想知道平常接觸到的植物乾不乾淨..."></textarea>
                </div>
                <div class="text-center mb-4">
                    <button id="ai-submit-btn" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-indigo-700 transition duration-300 disabled:bg-gray-400">
                        <i class="fas fa-magic mr-2"></i>開始煉金
                    </button>
                </div>
                <div id="ai-output-container" class="bg-indigo-50 p-6 rounded-lg min-h-[150px] hidden">
                     <h4 class="font-bold text-indigo-800 mb-2">AI 潤飾建議：</h4>
                     <div id="ai-output" class="text-gray-800 prose prose-sm max-w-none"></div>
                </div>
                 <div id="ai-loading" class="text-center hidden">
                    <i class="fas fa-spinner fa-spin text-3xl text-indigo-500"></i>
                    <p class="mt-2 text-gray-600">AI 正在為您提煉文字...</p>
                </div>
            </div>
        </section>

    </main>

    <div id="portfolioModal" class="fixed inset-0 z-[100] items-center justify-center hidden">
        <div class="modal-backdrop absolute inset-0" onclick="hidePortfolioModal()"></div>
        <div class="modal-content bg-white w-11/12 md:max-w-4xl mx-auto rounded-lg shadow-2xl z-10 flex flex-col">
            <div class="p-6 border-b flex justify-between items-center">
                <h3 id="modal-title" class="text-2xl font-bold"></h3>
                <button onclick="hidePortfolioModal()" class="text-gray-500 hover:text-gray-800 text-3xl font-light">&times;</button>
            </div>
            <div class="border-b border-gray-200">
                <nav id="modalTabs" class="-mb-px flex space-x-6 px-6" aria-label="Tabs">
                    <button class="tab-btn active border-b-2 font-semibold py-4 px-1 text-sm" onclick="showTab('preview')">範本預覽</button>
                    <button class="tab-btn border-b-2 border-transparent font-semibold py-4 px-1 text-sm text-gray-500 hover:text-gray-700" onclick="showTab('analysis')">亮點分析</button>
                </nav>
            </div>
            <div class="p-6 overflow-y-auto flex-grow">
                <div id="tab-content-preview">
                    <p id="modal-preview-desc" class="text-sm text-gray-500 mb-4"></p>
                    <img id="modal-preview-img" src="" alt="範例圖片" class="w-full h-auto rounded-md shadow-md" onerror="this.onerror=null;this.src='https://placehold.co/800x1131/ef4444/ffffff?text=圖片載入失敗';">
                </div>
                <div id="tab-content-analysis" class="hidden prose max-w-none">
                    </div>
            </div>
        </div>
    </div>

    <footer class="bg-gray-800 text-white mt-20">
        <div class="container mx-auto px-6 py-10">
            <p class="text-center text-gray-400">&copy; 2025 台灣教育處方籤 - 升級版</p>
        </div>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- Data Management (Unchanged) ---
        const galleryData = { '全部': [{ id: 1, category: '自然科學', title: '探究與實作：校園植物含菌量', imgSrc: 'https://images.pexels.com/photos/2280571/pexels-photo-2280571.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', desc: '一份關於「校園植物含菌量」的探究與實作報告。', analysis: `<h4>1. 問題意識清晰</h4><p>報告開頭就明確點出「為何想研究校園植物的含菌量？」，將動機與生活經驗（疫情、校園環境）連結，能快速抓住讀者目光。</p><h4>2. 研究過程視覺化</h4><p>善用圖表與照片。將枯燥的實驗步驟流程圖化，並附上清晰的實驗操作照片與培養皿結果對比圖，讓讀者能一目了然地理解整個研究過程。</p><h4>3. 數據呈現與解讀</h4><p>不只是羅列數據，而是將數據製作成清晰的長條圖，並在圖表下方用文字說明數據所代表的意義（例如：哪個區域的含菌量最高，可能的原因是什麼）。</p><h4>4. 反思具體且有延伸性</h4><p>心得反思不空泛。除了寫「學到團隊合作」，更具體描述了「組員間如何針對實驗變因進行討論與分工」，並提出「未來可進一步研究不同季節對含菌量的影響」，展現了持續探索的潛力。</p><h4>5. 版面簡潔易讀</h4><p>整體版面配置清爽，標題層次分明，字體與行距適中，讓教授在短時間內就能輕鬆閱讀，掌握重點。</p>` }, { id: 2, category: '社會科學', title: '小論文：手機使用與人際疏離', imgSrc: 'https://images.pexels.com/photos/7176026/pexels-photo-7176026.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', desc: '探討青少年手機成癮與現實人際關係變遷的關聯。', analysis: `<h4>1. 題目具時代感</h4><p>選題緊扣當代社會現象，容易引發共鳴，並展現學生對周遭世界的觀察力。</p><h4>2. 文獻探討扎實</h4><p>在研究方法中，引用了相關的心理學與社會學理論作為立論基礎，而不只是空談個人觀察，增加了報告的學術性。</p><h4>3. 採用質化研究</h4><p>透過深度訪談數名同學，記錄其真實心聲，讓報告充滿了「人味」，而不只是冰冷的數據。</p><h4>4. 結論提出具體建議</h4><p>除了分析現象，更提出了如「家庭數位公約」、「無手機社交活動」等具體可行的建議，展現解決問題的企圖心。</p>` }, { id: 3, category: '人文藝術', title: '作品集：我的城市速寫', imgSrc: 'https://images.pexels.com/photos/1470405/pexels-photo-1470405.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', desc: '以一系列手繪速寫，記錄對居住城市的觀察與情感。', analysis: `<h4>1. 主題連貫性強</h4><p>整個作品集圍繞「城市速寫」主題，風格統一，能看出作者持續性的投入與觀察。</p><h4>2. 圖文並茂</h4><p>每張速寫旁都附上簡短的文字，說明創作當下的心境、觀察到的有趣細節，讓畫作更有故事性。</p><h4>3. 展現個人風格</h4><p>無論是筆觸、用色、構圖，都呈現出獨特的個人美感，辨識度高。</p><h4>4. 編排具巧思</h4><p>作品集的排版不呆板，透過版面大小、留白、文字配置的變化，創造出閱讀的節奏感。</p>` }, { id: 4, category: '資訊科技', title: '自主學習：Python 爬蟲專案', imgSrc: 'https://images.pexels.com/photos/1181263/pexels-photo-1181263.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', desc: '利用 Python 爬取 PTT 八卦版文章，並進行文字雲分析。', analysis: `<h4>1. 展現自主學習能力</h4><p>明確說明自己是如何從零開始，透過線上課程、技術部落格學習 Python 語法與爬蟲套件 (BeautifulSoup, Scrapy)。</p><h4>2. 程式碼與成果並陳</h4><p>除了展示最終的文字雲成果，也附上部分關鍵程式碼截圖，並加上註解說明其功能，證明是親手實作。</p><h4>3. 專案具趣味性與應用性</h4><p>選擇 PTT 作為目標，能引發熟悉網路文化的教授的興趣，且文字雲分析是數據視覺化的實際應用。</p><h4>4. 記錄踩坑與解法</h4><p>在心得中誠實記錄開發中遇到的困難（如：IP被封鎖、動態網頁內容抓取），以及自己是如何透過查資料、嘗試不同方法解決的，這比一帆風順的過程更能展現學習韌性。</p>` }], '自然科學': [{ id: 1, category: '自然科學', title: '探究與實作：校園植物含菌量', imgSrc: 'https://images.pexels.com/photos/2280571/pexels-photo-2280571.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', desc: '一份關於「校園植物含菌量」的探究與實作報告。', analysis: `<h4>1. 問題意識清晰</h4><p>報告開頭就明確點出「為何想研究校園植物的含菌量？」，將動機與生活經驗（疫情、校園環境）連結，能快速抓住讀者目光。</p><h4>2. 研究過程視覺化</h4><p>善用圖表與照片。將枯燥的實驗步驟流程圖化，並附上清晰的實驗操作照片與培養皿結果對比圖，讓讀者能一目了然地理解整個研究過程。</p><h4>3. 數據呈現與解讀</h4><p>不只是羅列數據，而是將數據製作成清晰的長條圖，並在圖表下方用文字說明數據所代表的意義（例如：哪個區域的含菌量最高，可能的原因是什麼）。</p><h4>4. 反思具體且有延伸性</h4><p>心得反思不空泛。除了寫「學到團隊合作」，更具體描述了「組員間如何針對實驗變因進行討論與分工」，並提出「未來可進一步研究不同季節對含菌量的影響」，展現了持續探索的潛力。</p><h4>5. 版面簡潔易讀</h4><p>整體版面配置清爽，標題層次分明，字體與行距適中，讓教授在短時間內就能輕鬆閱讀，掌握重點。</p>` }], '社會科學': [{ id: 2, category: '社會科學', title: '小論文：手機使用與人際疏離', imgSrc: 'https://images.pexels.com/photos/7176026/pexels-photo-7176026.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', desc: '探討青少年手機成癮與現實人際關係變遷的關聯。', analysis: `<h4>1. 題目具時代感</h4><p>選題緊扣當代社會現象，容易引發共鳴，並展現學生對周遭世界的觀察力。</p><h4>2. 文獻探討扎實</h4><p>在研究方法中，引用了相關的心理學與社會學理論作為立論基礎，而不只是空談個人觀察，增加了報告的學術性。</p><h4>3. 採用質化研究</h4><p>透過深度訪談數名同學，記錄其真實心聲，讓報告充滿了「人味」，而不只是冰冷的數據。</p><h4>4. 結論提出具體建議</h4><p>除了分析現象，更提出了如「家庭數位公約」、「無手機社交活動」等具體可行的建議，展現解決問題的企圖心。</p>` }], '人文藝術': [{ id: 3, category: '人文藝術', title: '作品集：我的城市速寫', imgSrc: 'https://images.pexels.com/photos/1470405/pexels-photo-1470405.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', desc: '以一系列手繪速寫，記錄對居住城市的觀察與情感。', analysis: `<h4>1. 主題連貫性強</h4><p>整個作品集圍繞「城市速寫」主題，風格統一，能看出作者持續性的投入與觀察。</p><h4>2. 圖文並茂</h4><p>每張速寫旁都附上簡短的文字，說明創作當下的心境、觀察到的有趣細節，讓畫作更有故事性。</p><h4>3. 展現個人風格</h4><p>無論是筆觸、用色、構圖，都呈現出獨特的個人美感，辨識度高。</p><h4>4. 編排具巧思</h4><p>作品集的排版不呆板，透過版面大小、留白、文字配置的變化，創造出閱讀的節奏感。</p>` }], '資訊科技': [{ id: 4, category: '資訊科技', title: '自主學習：Python 爬蟲專案', imgSrc: 'https://images.pexels.com/photos/1181263/pexels-photo-1181263.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', desc: '利用 Python 爬取 PTT 八卦版文章，並進行文字雲分析。', analysis: `<h4>1. 展現自主學習能力</h4><p>明確說明自己是如何從零開始，透過線上課程、技術部落格學習 Python 語法與爬蟲套件 (BeautifulSoup, Scrapy)。</p><h4>2. 程式碼與成果並陳</h4><p>除了展示最終的文字雲成果，也附上部分關鍵程式碼截圖，並加上註解說明其功能，證明是親手實作。</p><h4>3. 專案具趣味性與應用性</h4><p>選擇 PTT 作為目標，能引發熟悉網路文化的教授的興趣，且文字雲分析是數據視覺化的實際應用。</p><h4>4. 記錄踩坑與解法</h4><p>在心得中誠實記錄開發中遇到的困難（如：IP被封鎖、動態網頁內容抓取），以及自己是如何透過查資料、嘗試不同方法解決的，這比一帆風順的過程更能展現學習韌性。</p>` }] };
        const reflectionData = { '專題研究': ['這個研究主題最初吸引你的地方是什麼？', '在研究過程中，你遇到的最大困難是什麼？你如何克服它？', '如果能重來一次，你會對研究方法或流程做哪些修改？為什麼？', '這個研究結果，對你個人或你關心的社群有什麼意義？', '完成這次專題後，你對這個領域產生了哪些新的問題？'], '社團幹部': ['擔任幹部期間，最有成就感的一件事是什麼？', '你如何與團隊成員溝通、協調衝突？請舉一個具體例子。', '這個經驗如何改變了你對「領導」的看法？', '你從中學習到最重要的軟實力是什麼？（例如：時間管理、公開演說）', '卸下幹部職務後，你希望為這個社團留下什麼？'], '志工服務': ['參與這次志工服務的初衷是什麼？', '服務過程中，印象最深刻的一個人或一件事是什麼？', '這次經驗是否改變了你對某些社會議題的看法？', '你認為自己為服務對象帶來了什麼？他們又為你帶來了什麼？', '未來你會如何持續關心這個議題？'], '競賽參與': ['準備競賽的過程中，你如何規劃你的時間與進度？', '這次競賽讓你發現自己在哪方面的知識或技能需要加強？', '無論輸贏，你認為從這次競賽中學到最重要的事是什麼？', '你如何與隊友（如果有的話）分工合作？', '這次經驗對你未來的學習或生涯規劃有什麼啟發？'] };
        const activityData = { '全部': [{ title: 'TRML 數學競賽', category: '學科競賽', desc: '針對高中生的團隊數學競賽，考驗解題與團隊合作能力。', link: 'https://www.trml.com.tw/' }, { title: '臺灣國際科學展覽會 (TISF)', category: '學科競賽', desc: '全國規模最大的高中科學研究競賽，優勝者可代表台灣出國參賽。', link: 'https://twsf.ntsec.gov.tw/' }, { title: '台大杜鵑花節', category: '大學營隊', desc: '台灣大學各學系的年度盛事，提供科系介紹、校園導覽與學長姐經驗分享。', link: 'https://event.ntu.edu.tw/azaleafestival/' }, { title: '伊甸基金會志工服務', category: '志工服務', desc: '提供各類型的志工服務機會，包含身心障礙、長者關懷等。', link: 'https://www.eden.org.tw/volunteer.php' }, { title: 'Coursera 線上課程', category: '線上學習', desc: '與全球頂尖大學合作，提供大量免費或付費的線上課程，可深化特定領域知識。', link: 'https://www.coursera.org/' }, { title: '全國高中生人文經典會考', category: '學科競賽', desc: '鼓勵高中生閱讀人文經典，透過競賽深化閱讀理解與思辨能力。', link: '#' }, { title: '台積電青年築夢計畫', category: '專案計畫', desc: '鼓勵青年提出結合科技與社會關懷的專案，並提供實踐獎金。', link: 'https://www.tsmc-foundation.org/zh/project/youth-dream' }], '學科競賽': [{ title: 'TRML 數學競賽', category: '學科競賽', desc: '針對高中生的團隊數學競賽，考驗解題與團隊合作能力。', link: 'https://www.trml.com.tw/' }, { title: '臺灣國際科學展覽會 (TISF)', category: '學科競賽', desc: '全國規模最大的高中科學研究競賽，優勝者可代表台灣出國參賽。', link: 'https://twsf.ntsec.gov.tw/' }, { title: '全國高中生人文經典會考', category: '學科競賽', desc: '鼓勵高中生閱讀人文經典，透過競賽深化閱讀理解與思辨能力。', link: '#' }], '大學營隊': [{ title: '台大杜鵑花節', category: '大學營隊', desc: '台灣大學各學系的年度盛事，提供科系介紹、校園導覽與學長姐經驗分享。', link: 'https://event.ntu.edu.tw/azaleafestival/' }], '志工服務': [{ title: '伊甸基金會志工服務', category: '志工服務', desc: '提供各類型的志工服務機會，包含身心障礙、長者關懷等。', link: 'https://www.eden.org.tw/volunteer.php' }], '線上學習': [{ title: 'Coursera 線上課程', category: '線上學習', desc: '與全球頂尖大學合作，提供大量免費或付費的線上課程，可深化特定領域知識。', link: 'https://www.coursera.org/' }], '專案計畫': [{ title: '台積電青年築夢計畫', category: '專案計畫', desc: '鼓勵青年提出結合科技與社會關懷的專案，並提供實踐獎金。', link: 'https://www.tsmc-foundation.org/zh/project/youth-dream' }] };

        // --- All the rendering and event handling logic (unchanged) ---
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenuBtn.addEventListener('click', () => { mobileMenu.classList.toggle('hidden'); });
        const galleryFiltersContainer = document.getElementById('gallery-filters');
        const galleryGrid = document.getElementById('gallery-grid');
        function renderGallery(filter = '全部') { galleryGrid.innerHTML = ''; const items = galleryData[filter]; items.forEach(item => { const card = document.createElement('div'); card.className = 'bg-white p-6 rounded-xl shadow-lg hover:shadow-2xl hover:-translate-y-2 transition-all duration-300 flex flex-col cursor-pointer'; card.onclick = () => showPortfolioModal(item); card.innerHTML = `<div class="flex-shrink-0"><img src="${item.imgSrc}" alt="${item.title}" class="w-full h-48 object-cover rounded-lg mb-4" onerror="this.onerror=null;this.src='https://placehold.co/600x400/ef4444/ffffff?text=圖片載入失敗';"><span class="text-sm font-semibold text-green-600 bg-green-100 py-1 px-3 rounded-full">${item.category}</span><h3 class="text-xl font-bold my-3">${item.title}</h3><p class="text-gray-600 mb-6">${item.desc}</p></div><div class="mt-auto"><span class="w-full text-center text-green-600 font-bold py-3 px-6 rounded-lg">查看詳情 <i class="fas fa-arrow-right ml-2"></i></span></div>`; galleryGrid.appendChild(card); }); }
        function renderGalleryFilters() { Object.keys(galleryData).forEach(category => { const button = document.createElement('button'); button.className = 'tag-btn px-4 py-2 font-semibold text-sm bg-white text-gray-800 rounded-full shadow-sm hover:bg-green-100 hover:text-green-800'; if (category === '全部') { button.classList.add('active', 'bg-green-500', 'text-white'); } button.textContent = category; button.onclick = (e) => { document.querySelectorAll('#gallery-filters .tag-btn').forEach(btn => btn.classList.remove('active', 'bg-green-500', 'text-white')); e.target.classList.add('active', 'bg-green-500', 'text-white'); renderGallery(category); }; galleryFiltersContainer.appendChild(button); }); }
        const portfolioModal = document.getElementById('portfolioModal');
        const modalTitle = document.getElementById('modal-title');
        const modalPreviewDesc = document.getElementById('modal-preview-desc');
        const modalPreviewImg = document.getElementById('modal-preview-img');
        const modalAnalysisContent = document.querySelector('#tab-content-analysis');
        const modalTabs = document.getElementById('modalTabs');
        const previewContent = document.getElementById('tab-content-preview');
        const analysisContent = document.getElementById('tab-content-analysis');
        window.showPortfolioModal = (item) => { modalTitle.textContent = item.title; modalPreviewDesc.textContent = item.desc; modalPreviewImg.src = item.imgSrc; modalPreviewImg.alt = item.title; modalAnalysisContent.innerHTML = item.analysis; portfolioModal.classList.remove('hidden'); portfolioModal.classList.add('flex'); document.body.style.overflow = 'hidden'; showTab('preview'); }
        window.hidePortfolioModal = () => { portfolioModal.classList.add('hidden'); portfolioModal.classList.remove('flex'); document.body.style.overflow = 'auto'; }
        window.showTab = (tabName) => { modalTabs.querySelectorAll('.tab-btn').forEach(btn => { btn.classList.remove('active'); btn.classList.add('text-gray-500', 'hover:text-gray-700', 'border-transparent'); }); const activeBtn = Array.from(modalTabs.querySelectorAll('.tab-btn')).find(btn => btn.getAttribute('onclick').includes(tabName)); activeBtn.classList.add('active'); activeBtn.classList.remove('text-gray-500', 'hover:text-gray-700', 'border-transparent'); previewContent.classList.toggle('hidden', tabName !== 'preview'); analysisContent.classList.toggle('hidden', tabName !== 'analysis'); }
        document.addEventListener('keydown', (e) => { if (e.key === "Escape") hidePortfolioModal(); });
        const categoryBtnsContainer = document.getElementById('reflection-category-btns');
        const questionOutput = document.getElementById('reflection-question-output');
        function renderCategoryButtons() { Object.keys(reflectionData).forEach(category => { const button = document.createElement('button'); button.className = 'px-4 py-2 font-semibold text-sm bg-gray-100 text-gray-800 rounded-full hover:bg-cyan-100 hover:text-cyan-800 transition'; button.textContent = category; button.onclick = () => generateQuestion(category); categoryBtnsContainer.appendChild(button); }); }
        function generateQuestion(category) { const questions = reflectionData[category]; const randomIndex = Math.floor(Math.random() * questions.length); const selectedQuestion = questions[randomIndex]; questionOutput.innerHTML = `<p class="text-xl font-semibold text-center text-cyan-800 animate-fade-in">${selectedQuestion}</p>`; categoryBtnsContainer.querySelectorAll('button').forEach(btn => { btn.classList.toggle('bg-cyan-500', btn.textContent === category); btn.classList.toggle('text-white', btn.textContent === category); btn.classList.toggle('bg-gray-100', btn.textContent !== category); btn.classList.toggle('text-gray-800', btn.textContent !== category); }); }
        const activityFiltersContainer = document.getElementById('activity-filters');
        const activityList = document.getElementById('activity-list');
        function renderActivities(filter = '全部') { activityList.innerHTML = ''; const items = activityData[filter]; if (!items || items.length === 0) { activityList.innerHTML = `<p class="text-center text-gray-500">此分類暫無活動資訊。</p>`; return; } items.forEach(item => { const card = document.createElement('div'); card.className = 'bg-gray-50 p-4 rounded-lg flex items-center justify-between hover:bg-gray-100 transition'; card.innerHTML = `<div><span class="text-xs font-semibold text-sky-600 bg-sky-100 py-1 px-2 rounded-full">${item.category}</span><h4 class="font-bold mt-1">${item.title}</h4><p class="text-sm text-gray-600">${item.desc}</p></div><a href="${item.link}" target="_blank" rel="noopener noreferrer" class="bg-sky-500 text-white text-sm font-bold py-2 px-4 rounded-lg shadow-md hover:bg-sky-600 transition duration-300 ml-4 flex-shrink-0">前往查看</a>`; activityList.appendChild(card); }); }
        function renderActivityFilters() { Object.keys(activityData).forEach(category => { const button = document.createElement('button'); button.className = 'tag-btn px-4 py-2 font-semibold text-sm bg-white text-gray-800 rounded-full shadow-sm hover:bg-sky-100 hover:text-sky-800'; if (category === '全部') { button.classList.add('active', 'bg-sky-500', 'text-white'); } button.textContent = category; button.onclick = (e) => { document.querySelectorAll('#activity-filters .tag-btn').forEach(btn => btn.classList.remove('active', 'bg-sky-500', 'text-white')); e.target.classList.add('active', 'bg-sky-500', 'text-white'); renderActivities(category); }; activityFiltersContainer.appendChild(button); }); }
        
        // --- AI Assistant Logic ---
        const aiSubmitBtn = document.getElementById('ai-submit-btn');
        const aiPromptInput = document.getElementById('ai-prompt');
        const aiInput = document.getElementById('ai-input');
        const aiOutputContainer = document.getElementById('ai-output-container');
        const aiOutput = document.getElementById('ai-output');
        const aiLoading = document.getElementById('ai-loading');

        aiSubmitBtn.addEventListener('click', async () => {
            const userPrompt = aiPromptInput.value.trim();
            const userInput = aiInput.value.trim();

            if (!userInput) {
                alert('請先在輸入框中寫下您的初步想法！');
                return;
            }

            const fullPrompt = `你是一位專業的學習歷程檔案指導老師。請根據以下引導問題和學生的初步想法，用繁體中文幫他潤飾成一段更完整、更有條理、更能展現反思深度的文字。請保留學生的核心想法，但用更精確的詞彙和流暢的句子來呈現。請直接提供潤飾後的文字，不需要加上額外的開頭或結語。

引導問題：${userPrompt || '（無）'}

學生初步想法：
"${userInput}"`;

            aiSubmitBtn.disabled = true;
            aiLoading.classList.remove('hidden');
            aiOutputContainer.classList.add('hidden');
            
            try {
                // This is the part to be replaced
                let chatHistory = [{ role: "user", parts: [{ text: fullPrompt }] }];
                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    throw new Error(`API 請求失敗，狀態碼：${response.status}`);
                }

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    let htmlText = text.replace(/\n/g, '<br>');
                    aiOutput.innerHTML = htmlText;
                    aiOutputContainer.classList.remove('hidden');
                } else {
                    throw new Error('從 API 收到的回應格式不正確。');
                }

            } catch (error) {
                console.error("AI Assistant Error:", error);
                aiOutput.innerHTML = `<p class="text-red-600">抱歉，AI 助理發生錯誤，請稍後再試。(${error.message})</p>`;
                aiOutputContainer.classList.remove('hidden');
            } finally {
                aiSubmitBtn.disabled = false;
                aiLoading.classList.add('hidden');
            }
        });


        // --- Initial Render ---
        renderGalleryFilters();
        renderGallery();
        renderCategoryButtons();
        renderActivityFilters();
        renderActivities();
    });
    </script>
</body>
</html>
