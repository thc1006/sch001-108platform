<!DOCTYPE html>
<html lang="zh-Hant" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>線上製作工具箱 2.0 (Puter.js 智慧版) - 台灣教育處方籤</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/lucide@0.378.0/dist/lucide.min.js"></script>

    <script src="https://js.puter.com/v2/"></script>

    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #fefbf6; /* A warmer background color */
        }
        .gradient-text {
            background: linear-gradient(45deg, #f97316, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }
        .filter-btn.active {
            background-color: #d97706; /* A deeper amber for active state */
            color: white;
            box-shadow: 0 4px 14px 0 rgb(0 0 0 / 0.1);
            transform: translateY(-2px);
        }
        .filter-btn {
            transition: all 0.2s ease-in-out;
        }
        .tool-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #fde68a;
            background-color: white;
        }
        .tool-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        #mobile-menu {
            transition: transform 0.3s ease-in-out;
        }
        .tag {
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-weight: 600;
        }
        /* Modal Styles */
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        /* Spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #f97316;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Prose styles for AI output */
        .prose h3 { font-size: 1.25rem; font-weight: bold; margin-top: 1.5rem; margin-bottom: 0.5rem; }
        .prose p { margin-bottom: 1rem; line-height: 1.75; }
        .prose ul { list-style-type: disc; margin-left: 1.5rem; margin-bottom: 1rem; }
        .prose li { margin-bottom: 0.5rem; }
        .prose strong { font-weight: bold; }
        .prose a { color: #f97316; text-decoration: underline; }
    </style>
</head>
<body class="text-gray-800">

    <header class="bg-white/80 backdrop-blur-lg shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-4 sm:px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-black text-amber-600">
                <a href="#">台灣教育處方籤</a>
            </div>
            <div class="hidden md:flex space-x-8 items-center">
                <a href="#" class="text-gray-600 hover:text-amber-500 transition duration-300">自主學習啟航站</a>
                <a href="#" class="text-amber-600 font-semibold border-b-2 border-amber-500 pb-1">學習歷程煉金室</a>
                <a href="#" class="text-gray-600 hover:text-amber-500 transition duration-300">未來生涯GPS</a>
                <a href="#" class="text-gray-600 hover:text-amber-500 transition duration-300">進階資源探索區</a>
            </div>
            <div class="md:hidden">
                <button id="mobile-menu-button" class="text-gray-700 hover:text-amber-600 focus:outline-none">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </nav>
        <div id="mobile-menu" class="md:hidden hidden bg-white border-t border-gray-200">
            <a href="#" class="block py-3 px-6 text-gray-600 hover:bg-gray-50">自主學習啟航站</a>
            <a href="#" class="block py-3 px-6 text-amber-600 font-semibold bg-amber-50">學習歷程煉金室</a>
            <a href="#" class="block py-3 px-6 text-gray-600 hover:bg-gray-50">未來生涯GPS</a>
            <a href="#" class="block py-3 px-6 text-gray-600 hover:bg-gray-50">進階資源探索區</a>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 py-12 md:py-16">
        <section class="text-center mb-12 md:mb-16">
            <h1 class="text-4xl md:text-6xl font-black text-gray-900 mb-4 tracking-tight">
                線上製作<span class="gradient-text">工具箱 2.0</span>
            </h1>
            <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto">
                工欲善其事，必先利其器。讓 AI 幫你從任務出發，找到最順手的神兵利器。
            </p>
        </section>

        <section class="mb-12 md:mb-16">
            <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 border border-amber-100">
                <div class="flex items-center mb-4">
                    <svg data-lucide="lightbulb-icon" class="w-8 h-8 text-amber-500 mr-3"></svg>
                    <h2 class="text-2xl md:text-3xl font-bold text-gray-800">AI 工具推薦官</h2>
                </div>
                <p class="text-gray-600 mb-5">請描述你要完成的「任務」，AI 將為你推薦最適合的工具，並說明使用建議。</p>
                <div class="flex flex-col sm:flex-row gap-4">
                    <input type="text" id="ai-recommender-input" placeholder="例如：做一份關於台灣黑熊的簡報、整理科展數據..." class="flex-grow w-full px-4 py-3 border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition duration-200 text-base" />
                    <button id="ai-recommender-button" class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 flex items-center justify-center">
                        <svg data-lucide="wand-2" class="w-5 h-5 mr-2"></svg>
                        <span>尋找工具</span>
                    </button>
                </div>
            </div>
        </section>

        <section class="mb-12 flex justify-center">
            <div id="category-filters" class="flex flex-wrap justify-center gap-2 md:gap-4 bg-white p-3 rounded-full shadow-sm">
                </div>
        </section>

        <section>
            <div id="tool-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8"></div>
             <div id="no-results" class="hidden text-center py-16">
                <svg class="mx-auto h-16 w-16 text-gray-400" data-lucide="folder-search"></svg>
                <h3 class="mt-4 text-xl font-bold text-gray-800">找不到相符的工具</h3>
                <p class="mt-2 text-gray-500">試著更換你的篩選條件看看。</p>
            </div>
        </section>
    </main>

    <footer class="bg-gray-900 text-white mt-20">
        <div class="container mx-auto px-6 py-12 text-center">
             <p class="mb-4 text-gray-400">有超好用的工具想推薦給大家？</p>
            <a href="mailto:suggest@example.com?subject=線上工具推薦" class="bg-amber-600 hover:bg-amber-500 text-white font-bold py-3 px-6 rounded-lg transition duration-300 inline-block">
                推薦一個工具
            </a>
            <p class="text-sm text-gray-500 mt-8">&copy; 2025 台灣教育處方籤 - Puter.js 智慧版</p>
        </div>
    </footer>
    
    <button id="back-to-top" class="hidden fixed bottom-8 right-8 bg-amber-600 hover:bg-amber-700 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center transition-opacity duration-300">
        <svg data-lucide="arrow-up"></svg>
    </button>

    <div id="ai-modal" class="fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center z-[100] p-4 hidden modal-overlay opacity-0">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col modal-content opacity-0 transform scale-95">
            <div class="flex justify-between items-center p-5 border-b border-gray-200 flex-shrink-0">
                <h3 id="ai-modal-title" class="text-xl font-bold text-gray-800">AI 生成內容</h3>
                <button id="ai-modal-close" class="text-gray-400 hover:text-gray-800 transition-colors">
                    <svg data-lucide="x"></svg>
                </button>
            </div>
            <div id="ai-modal-body" class="p-6 overflow-y-auto prose max-w-none"></div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const initializeApp = () => {
            // --- 資料庫 (Data) ---
            const tools = [
                { name: 'Canva', category: '簡報排版', description: '強大且極易上手的線上設計平台，內建海量模板，讓你不用是設計師也能做出專業級的學習歷程、簡報與海報。', tags: ['學習歷程封面', '資訊圖表', '簡報設計'], pricing: '免費增值', url: 'https://www.canva.com/', icon: 'layout-template' },
                { name: 'Figma', category: '簡報排版', description: '專業級的雲端UI/UX設計工具，功能強大且協作功能完善。學習曲線稍高，但非常適合用來製作高度客製化的報告排版。', tags: ['專業排版', '原型設計', '團隊協作'], pricing: '免費增值', url: 'https://www.figma.com/', icon: 'figma' },
                { name: 'Google Slides', category: '簡報排版', description: '最普及的線上簡報工具，操作直觀、易於上手，並支援多人即時協作，適合小組報告與課堂發表。', tags: ['小組報告', '快速簡報', '雲端協作'], pricing: '免費', url: 'https://www.google.com/slides/about/', icon: 'presentation' },
                { name: 'XMind', category: '心智圖', description: '介面美觀、功能專注的心智圖軟體。非常適合用來進行腦力激盪、整理報告架構、或梳理複雜的知識體系。', tags: ['腦力激盪', '報告大綱', '知識整理'], pricing: '免費增值', url: 'https://xmind.app/', icon: 'brain-cog' },
                { name: 'Miro', category: '心智圖', description: '一個功能無限的線上白板，除了心智圖，還能做流程圖、便利貼、看板等。特別適合小組線上討論與腦力激盪。', tags: ['團隊協作', '線上白板', '流程圖'], pricing: '免費增值', url: 'https://miro.com/', icon: 'clipboard-pen' },
                { name: 'Google Sheets', category: '數據視覺化', description: '強大的線上試算表工具，不僅能處理數據，更能輕鬆製作出長條圖、折線圖、圓餅圖等各種基本圖表，並嵌入報告中。', tags: ['問卷分析', '基本圖表', '數據處理'], pricing: '免費', url: 'https://www.google.com/sheets/about/', icon: 'bar-chart-3' },
                { name: 'Flourish', category: '數據視覺化', description: '想讓你的圖表動起來？Flourish提供多種精美且具互動性的動態圖表模板，能讓你的數據故事更引人入勝。', tags: ['動態圖表', '互動式地圖', '數據故事'], pricing: '免費增值', url: 'https://flourish.studio/', icon: 'area-chart' },
                { name: 'Notion', category: '筆記寫作', description: '一個全功能的數位工作區，結合了筆記、資料庫、看板、日曆等多種功能。適合用來建立個人知識庫與管理自主學習專案。', tags: ['知識管理', '專案管理', '數位筆記'], pricing: '免費增值', url: 'https://www.notion.so/', icon: 'notebook-tabs' },
                { name: 'HackMD', category: '筆記寫作', description: '一個支援 Markdown 語法的即時協作筆記平台，非常適合程式學習者、或是需要快速撰寫並分享帶有程式碼或數學公式的筆記。', tags: ['Markdown', '程式筆記', '共筆文件'], pricing: '免費增值', url: 'https://hackmd.io/', icon: 'file-text' }
            ];

            // --- DOM 元素 ---
            const toolGrid = document.getElementById('tool-grid');
            const noResultsDiv = document.getElementById('no-results');
            const filtersContainer = document.getElementById('category-filters');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const backToTopButton = document.getElementById('back-to-top');
            const aiRecommenderButton = document.getElementById('ai-recommender-button');
            const aiRecommenderInput = document.getElementById('ai-recommender-input');
            const aiModal = document.getElementById('ai-modal');
            const aiModalTitle = document.getElementById('ai-modal-title');
            const aiModalBody = document.getElementById('ai-modal-body');
            const aiModalClose = document.getElementById('ai-modal-close');

            let currentCategory = 'all';

            // --- ✨ 步驟 2: 移除舊的 Gemini API 函式 ---
            // (舊的 callGemini 函式已被刪除)

            // --- Modal ---
            function openModal(title, content) {
                aiModalTitle.textContent = title;
                aiModalBody.innerHTML = content;
                aiModal.classList.remove('hidden');
                setTimeout(() => {
                    aiModal.classList.remove('opacity-0');
                    aiModal.querySelector('.modal-content').classList.remove('opacity-0', 'scale-95');
                }, 10);
            }

            function closeModal() {
                aiModal.classList.add('opacity-0');
                aiModal.querySelector('.modal-content').classList.add('opacity-0', 'scale-95');
                setTimeout(() => aiModal.classList.add('hidden'), 300);
            }

            // --- Core Functions ---
            function renderTools() {
                const filteredTools = currentCategory === 'all' ? tools : tools.filter(tool => tool.category === currentCategory);
                toolGrid.innerHTML = '';
                
                noResultsDiv.classList.toggle('hidden', filteredTools.length > 0);
                toolGrid.classList.toggle('hidden', filteredTools.length === 0);

                filteredTools.forEach(tool => toolGrid.appendChild(createToolCard(tool)));
                lucide.createIcons();
            }

            function createToolCard(tool) {
                const card = document.createElement('div');
                card.className = 'tool-card bg-white rounded-xl shadow-md flex flex-col';
                
                const tagsHtml = tool.tags.map(tag => `<span class="tag bg-amber-100 text-amber-800">${tag}</span>`).join(' ');
                let pricingColor = tool.pricing === '免費' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800';

                card.innerHTML = `
                    <div class="p-6 flex-grow">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center">
                                <div class="w-16 h-16 flex-shrink-0 mr-4 bg-amber-50 rounded-lg flex items-center justify-center">
                                    <svg data-lucide="${tool.icon}" class="w-9 h-9 text-amber-600"></svg>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900">${tool.name}</h3>
                                    <p class="text-sm font-bold text-amber-700">${tool.category}</p>
                                </div>
                            </div>
                            <span class="tag ${pricingColor}">${tool.pricing}</span>
                        </div>
                        <p class="text-gray-700 mb-4">${tool.description}</p>
                        <div>
                            <p class="text-xs text-gray-500 mb-2 font-semibold">適用情境：</p>
                            <div class="flex flex-wrap gap-2">${tagsHtml}</div>
                        </div>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-b-xl mt-auto grid grid-cols-2 gap-2">
                        <button class="ai-tips-button w-full text-center bg-amber-100 text-amber-800 font-bold py-2 px-4 rounded-lg hover:bg-amber-200 transition duration-300 flex items-center justify-center gap-1.5">
                            <svg data-lucide="sparkles" class="w-4 h-4"></svg> AI 使用技巧
                        </button>
                        <a href="${tool.url}" target="_blank" rel="noopener noreferrer" class="w-full text-center bg-amber-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-amber-700 transition duration-300 flex items-center justify-center gap-1.5">
                            前往使用 <svg data-lucide="arrow-right" class="w-4 h-4"></svg>
                        </a>
                    </div>
                `;
                // Add data attributes to the AI button for the event handler
                card.querySelector('.ai-tips-button').dataset.name = tool.name;
                card.querySelector('.ai-tips-button').dataset.description = tool.description;

                return card;
            }

            function generateFilterButtons() {
                const categories = ['all', ...new Set(tools.map(t => t.category))];
                filtersContainer.innerHTML = '';
                categories.forEach(category => {
                    const button = document.createElement('button');
                    button.className = 'filter-btn px-4 py-2 font-semibold text-sm rounded-full transition';
                    button.textContent = category === 'all' ? '全部工具' : category;
                    button.dataset.category = category;
                    if (category === 'all') button.classList.add('active');
                    filtersContainer.appendChild(button);
                });
            }
            
            // --- ✨ 步驟 3: 將事件處理器改用 Puter.js (流式輸出) ---

            function handleFilterClick(e) {
                const target = e.target.closest('.filter-btn');
                if (!target) return;
                filtersContainer.querySelector('.active').classList.remove('active');
                target.classList.add('active');
                currentCategory = target.dataset.category;
                renderTools();
            }
            
            async function handleAiRequest(prompt, title) {
                openModal(title, '<div class="flex justify-center items-center h-48"><div class="loader"></div></div>');
                try {
                    const responseStream = await puter.ai.chat(prompt, {
                        model: 'google/gemini-2.0-flash-lite-001',
                        stream: true
                    });

                    aiModalBody.innerHTML = ''; // 清空載入動畫
                    for await (const part of responseStream) {
                        if (part?.text) {
                            // 將 Markdown 換行符轉為 HTML <br>
                            aiModalBody.innerHTML += part.text.replace(/\n/g, '<br>');
                        }
                    }
                } catch (error) {
                    console.error("Puter.js AI request failed:", error);
                    aiModalBody.innerHTML = `<p class="text-red-600">抱歉，AI 服務暫時無法連線，請稍後再試。</p><p class="text-sm text-gray-500 mt-2">${error.message}</p>`;
                }
            }

            async function handleRecommenderSubmit() {
                const task = aiRecommenderInput.value.trim();
                if (!task) { alert("請先輸入你要完成的任務！"); return; }
                const prompt = `你是一位專業的台灣高中生數位學習顧問。請根據以下 JSON 格式的可用「線上工具」列表，為一位學生推薦工具。學生的任務是：「${task}」。請用繁體中文回答，以 Markdown 格式推薦 1-2 個最適合的工具，並針對每個工具說明「推薦理由」與「使用建議」，解釋這個工具如何幫助學生更有效率地完成任務。可用工具如下：\n\n${JSON.stringify(tools)}`;
                handleAiRequest(prompt, "✨ AI 工具推薦官");
            }

            async function handleTipsClick(e) {
                const target = e.target.closest('.ai-tips-button');
                if (!target) return;
                const { name, description } = target.dataset;
                const prompt = `你是一位專業的台灣高中生數位學習顧問。請針對以下這個工具，提供 2-3 個實用的「高中生使用技巧」。工具名稱：「${name}」，描述：「${description}」。請用繁體中文、條列式回答，技巧需緊扣高中生的學習情境（例如：製作學習歷程、準備小組報告、進行自主學習研究）。`;
                handleAiRequest(prompt, `✨ ${name} - AI 使用技巧`);
            }

            // --- Initialization ---
            generateFilterButtons();
            renderTools();

            // Event Listeners
            filtersContainer.addEventListener('click', handleFilterClick);
            aiRecommenderButton.addEventListener('click', handleRecommenderSubmit);
            aiRecommenderInput.addEventListener('keydown', (e) => {
                if(e.key === 'Enter') handleRecommenderSubmit();
            });
            toolGrid.addEventListener('click', handleTipsClick);
            aiModalClose.addEventListener('click', closeModal);
            aiModal.addEventListener('click', e => {
                if (e.target === aiModal) closeModal();
            });
            mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
            window.addEventListener('scroll', () => backToTopButton.classList.toggle('hidden', window.scrollY <= 300));
            backToTopButton.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
        };

        const checkLucideAndInit = () => {
            if (typeof lucide !== 'undefined') initializeApp();
            else setTimeout(checkLucideAndInit, 100);
        };
        checkLucideAndInit();
    });
    </script>
</body>
</html>
